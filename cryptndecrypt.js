// TWL2.0 ONLINE Bookmarklet
// v2.3
// By Zeraw (zerawmaster@gmail.com)
// Description :
// Bookmarklet intelligent cryptant et décryptant en fonction de la position (dans une zone de texte ou non) du curseur et de la sélection (avec ou sans texte sélectionné)

function ActionSelectionHorsInput(e){header=substr(e,0,6),"TWL2.0"==header||"TWL2.2"==header?(decrypte=decrypter(e,!0),compteur(),resultat='<form action="http://twl2.fr.nf/decrypte.php" name="FormDecryptage" method="post" target="_blank" style="display:none;"><textarea name="crypte" cols="1" rows="1">'+e+'</textarea></form><p id="panneau_nav_bar"><a href="javascript:selectionner(\'resultat\');" title="S&eacute;lectionner le r&eacute;sultat">S&eacute;lectionner</a> - <a href="javascript:document.FormDecryptage.submit();" title="D&eacute;crypter dans une autre interface (utilisateurs de gestionnaires de t&eacute;l&eacute;chargement)">Autre Interface</a> - <a href="javascript:fermerDiv(\'panneau_bookmarklet_twl2\');" title="Fermer le cadre">Fermer</a></p><p id="resultat">'+decrypte+"</p>",ajouteElement("div",resultat,"panneau_bookmarklet_twl2")):"TWL2.1"==header?(resultat='<p id="panneau_nav_bar"><a href="javascript:fermerDiv(\'panneau_bookmarklet_twl2\');" title="Supprimer">Fermer</a></p><p id="resultat">Le cryptage n\'est pas en TWL2.0 mais en TWL2.1.<br />Il n\'est donc pas d&eacute;cryptable avec cet outil.</p>',ajouteElement("div",resultat,"panneau_bookmarklet_twl2")):(crypte=crypter(e),compteur(),resultat='<form action="http://twl2.fr.nf/crypte.php" name="FormCryptage" method="post" target="_blank" style="display:none;"><textarea name="clair" cols="1" rows="1">'+e+'</textarea></form><p id="panneau_nav_bar"><a href="javascript:selectTextarea(\'panneau_textarea_result_crypte\');" title="S&eacute;lectionner le r&eacute;sultat">S&eacute;lectionner</a> - <a href="javascript:document.FormCryptage.submit();" title="Crypter dans une autre interface">Autre Interface</a> - <a href="javascript:fermerDiv(\'panneau_bookmarklet_twl2\');" title="Fermer le cadre">Fermer</a></p><p id="resultat"><textarea id="panneau_textarea_result_crypte" cols="1" rows="1">'+crypte+"</textarea></p>",ajouteElement("div",resultat,"panneau_bookmarklet_twl2"))}function ActionDansInputTransformationSelection(e){if(e.length>0){if(header=substr(e,0,6),"TWL2.0"==header||"TWL2.2"==header){var t=decrypter(e,!0),r=decrypter(e,!1);return compteur(),resultat='<form action="http://twl2.fr.nf/decrypte.php" name="FormDecryptage" method="post" target="_blank" style="display:none;"><textarea name="crypte" cols="1" rows="1">'+e+'</textarea></form><p id="panneau_nav_bar"><a href="javascript:selectionner(\'resultat\');" title="S&eacute;lectionner le r&eacute;sultat">S&eacute;lectionner</a> - <a href="javascript:document.FormDecryptage.submit();" title="D&eacute;crypter dans une autre interface (utilisateurs de gestionnaires de t&eacute;l&eacute;chargement)">Autre Interface</a> - <a href="javascript:fermerDiv(\'panneau_bookmarklet_twl2\');" title="Fermer le cadre">Fermer</a></p><p id="resultat">'+t+"</p>",ajouteElement("div",resultat,"panneau_bookmarklet_twl2"),txt_=r}return"TWL2.1"==header?(resultat='<p id="panneau_nav_bar"><a href="javascript:fermerDiv(\'panneau_bookmarklet_twl2\');" title="Supprimer">Fermer</a></p><p id="resultat">Le cryptage n\'est pas en TWL2.0 mais en TWL2.1.<br />Il n\'est donc pas d&eacute;cryptable avec cet outil.</p>',ajouteElement("div",resultat,"panneau_bookmarklet_twl2"),txt_=e):(crypte=crypter(e,!0),compteur(),resultat='<p id="panneau_nav_bar"><a href="javascript:fermerDiv(\'panneau_bookmarklet_twl2\');" title="Fermer le cadre">Fermer</a></p><p id="resultat">Faites d&eacute;couvrir le site et son bookmarklet en rajoutant &agrave; votre message une userbarre ! <br />Il vous suffit de placer votre curseur &agrave; l\'endroit o&ugrave; vous voulez l\'ajouter - sans faire de s&eacute;lection - puis de cliquer sur le <acronym title="Favoris Intelligent">bookmarklet</acronym> !<br />C\'est tout, mais &ccedil;a aide beaucoup !<br />Merci<br />Zeraw</p>',ajouteElement("div",resultat,"panneau_bookmarklet_twl2"),txt_=crypte)}return $("panneau_bookmarklet_twl2")&&fermerDiv("panneau_bookmarklet_twl2"),txt_="[url=http://twl2.fr.nf/][img]http://twl2.fr.nf/ub/?ub=userbar_3.gif[/img][/url][url=http://twl2.fr.nf/divers.php][img]http://twl2.fr.nf/ub/?npc&ub=bouton_bookmarklet.gif[/img][/url][url=http://twl2.fr.nf/][img]http://twl2.fr.nf/ub/?npc&ub=bouton_site.gif[/img][/url][url=http://forum.thiweb.com/viewtopic.php?f=9&t=1242][img]http://twl2.fr.nf/ub/?npc&ub=bouton_tuto.gif[/img][/url]"}function ActionDansInput(){var e=objFocused();if(e)if(e.focus(),"undefined"!=typeof e.selectionStart){var t=e.selectionStart,r=e.selectionEnd,a=e.scrollTop,n=e.value,o=n.substring(0,t),i=n.substring(r,e.textLength),l=n.substring(t,r),c=ActionDansInputTransformationSelection(l);e.value=o+c+i,e.setSelectionRange(o.length+c.length,o.length+c.length),e.scrollTop=a,e.focus()}else{var l=document.selection.createRange().text,c=ActionDansInputTransformationSelection(l);if(l.length>0){var n=document.selection.createRange();n.text=c,n.collapse(),n.select()}else{var n=e.value,u="~~",s=document.selection.createRange().duplicate();s.text=u;var t=e.value.search(u),o=n.substring(0,t),i=n.substring(t,e.textLength);e.value=o+c+l+i,t+=c.length,t-=Get_NbrCR(o),n=e.createTextRange(),n.moveStart("character",t),n.collapse(),n.select()}}}function decrypter(e,t){if(header=substr(e,0,6),e=str_replace(" ","",e),e=str_replace("\r","",e),e=str_replace("\n","",e),e=substr(e,6),"TWL2.0"==header){for(str="",i=0;i<strlen(e);i+=2)c=substr(e,i,2),str+="AD"==c?"A0D0":c;e=str}if(e=strrev(e),decrypte=hex2ascii(e),t){decrypte=htmlentities(decrypte),decrypte=nl2br(decrypte);var r=new RegExp("([a-zA-Z0-9]+(://)[^ <>]+)+","gi");decrypte=decrypte.replace(r,"<a href='http://twl2.fr.nf/no-referer.php?u=$1' target=_blank>$1</a>")}return decrypte}function crypter(e,t){return hexrev=strtoupper(strrev(bin2hex(stripslashes(e)))),crypte="TWL2.2"+hexrev,crypte=wordwrap(crypte,65," ",1),t&&(crypte="[code]"+crypte+"[/code]"),crypte}function ajouteElement(e,t,r){$(r)&&document.body.removeChild($(r)),nouvelElement=document.createElement(e),nouvelElement.innerHTML=t,nouvelElement.id=r,document.body.appendChild(nouvelElement)}function fermerDiv(e,t){if(acth=act_height(e),maxh=max_height(e),t||(t=10*acth),acth==maxh){$(e).style.display="block";var r;for(r=Math.ceil(t/acth),STO("document.body.removeChild($('"+e+"'));",r*acth),i=0;acth>=i;i++)newPosition=i,STO("$('"+e+"').style.top='-"+newPosition+"px'",r*i)}}function compteur(){void(y=document.createElement("script")),void(y.src="http://twl2.fr.nf/compteur.php"),void document.body.appendChild(y)}function selectTextarea(e){document.getElementById(e).select()}function selectionner(e){var t=document.getElementById(e);if(window.getSelection){var r=window.getSelection();if(r.setBaseAndExtent)r.setBaseAndExtent(t,0,t,t.innerText.length-1);else{var a=document.createRange();a.selectNodeContents(t),r.removeAllRanges(),r.addRange(a)}}else if(document.getSelection){var r=document.getSelection(),a=document.createRange();a.selectNodeContents(t),r.removeAllRanges(),r.addRange(a)}else if(document.selection){var a=document.body.createTextRange();a.moveToElementText(t),a.select()}}function tagFocused(){return tagFocused=document.activeElement.tagName}function objFocused(){return document.activeElement?objFocused=document.activeElement:(idFocused="message",document.getElementById(idFocused))}function idFocused(){return idFocused=document.activeElement?document.activeElement.id:"message"}function Get_NbrCR(e){for(var t=0,r=e.indexOf("\r\n");r>-1;)r=e.indexOf("\r\n",r+2),t++;return t}function $(e){return document.getElementById(e)}function STO(e,t){return window.setTimeout(e,t)}function act_height(e){return height=$(e).clientHeight,0==height&&(height=$(e).offsetHeight),height}function max_height(e){var t=$(e).style;return t.overflow="hidden",0!=act_height(e)?act_height(e):(origdisp=t.display,origheight=t.height,origpos=t.position,origvis=t.visibility,t.visibility="hidden",t.height="",t.display="block",t.position="absolute",height=act_height(e),t.display=origdisp,t.height=origheight,t.position=origpos,t.visibility=origvis,height)}function hex2ascii(e){var t="";for(i=0;i<strlen(e);i+=2)t=t.concat(chr(hexdec(substr(e,i,2))));return t}function str_replace(e,t,r){for(var a=e,n=t,o=r,i=n instanceof Array,l=o instanceof Array,a=[].concat(a),n=[].concat(n),c=(o=[].concat(o)).length;j=0,c--;)if(o[c])for(;o[c]=o[c].split(a[j]).join(i?n[j]||"":n[0]),++j in a;);return l?o:o[0]}function strlen(e){return(e+"").length}function hexdec(e){return e=(e+"").replace(/[^a-f0-9]/gi,""),parseInt(e,16)}function chr(e){return String.fromCharCode(e)}function isset(){var e=arguments,t=e.length,r=0;if(0==t)throw new Error("Empty isset");for(;r!=t;){if("undefined"==typeof e[r]||null===e[r])return!1;r++}return!0}function substr(e,t,r){return e+="",0>t&&(t+=e.length),void 0==r?r=e.length:r+=0>r?e.length:t,t>r&&(r=t),e.substring(t,r)}function strrev(e){var t="",r=0;for(e+="",r=e.length-1;r>=0;r--)t+=e.charAt(r);return t}function nl2br(e,t){return breakTag="<br />","undefined"==typeof t||t||(breakTag="<br>"),(e+"").replace(/([^>]?)\n/g,"$1"+breakTag+"\n")}function htmlentities(e,t){var r={},a="",n="";if(n=e.toString(),!1===(r=get_html_translation_table("HTML_ENTITIES",t)))return!1;for(a in r)entity=r[a],n=n.split(a).join(entity);return n}function get_html_translation_table(e,t){var r={},a={},n=0,o="",i={},l={},c={},u={};if(c=e?e.toUpperCase():"HTML_SPECIALCHARS",u=t?t.toUpperCase():"ENT_COMPAT",i[0]="HTML_SPECIALCHARS",i[1]="HTML_ENTITIES",l[0]="ENT_NOQUOTES",l[2]="ENT_COMPAT",l[3]="ENT_QUOTES",isNaN(c)||(c=i[c]),isNaN(u)||(u=l[u]),"HTML_SPECIALCHARS"==c)r[38]="&amp;",r[60]="&lt;",r[62]="&gt;";else{if("HTML_ENTITIES"!=c)throw Error("Table: "+c+" not supported");var r={38:"&amp;",60:"&lt;",62:"&gt;",94:"&circ;",126:"&tilde;",130:"&sbquo;",131:"&fnof;",132:"&bdquo;",133:"&hellip;",134:"&dagger;",135:"&Dagger;",136:"&circ;",137:"&permil;",138:"&Scaron;",139:"&lsaquo;",140:"&OElig;",145:"&lsquo;",146:"&rsquo;",147:"&ldquo;",148:"&rdquo;",149:"&bull;",150:"&ndash;",151:"&mdash;",152:"&tilde;",153:"&trade;",154:"&scaron;",155:"&rsaquo;",156:"&oelig;",159:"&Yuml;",160:"&nbsp;",161:"&iexcl;",162:"&cent;",163:"&pound;",164:"&curren;",165:"&yen;",166:"&brvbar;",167:"&sect;",168:"&uml;",169:"&copy;",170:"&ordf;",171:"&laquo;",172:"&not;",173:"&shy;",174:"&reg;",175:"&macr;",176:"&deg;",177:"&plusmn;",178:"&sup2;",179:"&sup3;",180:"&acute;",181:"&micro;",182:"&para;",183:"&middot;",184:"&cedil;",185:"&sup1;",186:"&ordm;",187:"&raquo;",188:"&frac14;",189:"&frac12;",190:"&frac34;",191:"&iquest;",192:"&Agrave;",193:"&Aacute;",194:"&Acirc;",195:"&Atilde;",196:"&Auml;",197:"&Aring;",198:"&AElig;",199:"&Ccedil;",200:"&Egrave;",201:"&Eacute;",202:"&Ecirc;",203:"&Euml;",204:"&Igrave;",205:"&Iacute;",206:"&Icirc;",207:"&Iuml;",208:"&ETH;",209:"&Ntilde;",210:"&Ograve;",211:"&Oacute;",212:"&Ocirc;",213:"&Otilde;",214:"&Ouml;",215:"&times;",216:"&Oslash;",217:"&Ugrave;",218:"&Uacute;",219:"&Ucirc;",220:"&Uuml;",221:"&Yacute;",222:"&THORN;",223:"&szlig;",224:"&agrave;",225:"&aacute;",226:"&acirc;",227:"&atilde;",228:"&auml;",229:"&aring;",230:"&aelig;",231:"&ccedil;",232:"&egrave;",233:"&eacute;",234:"&ecirc;",235:"&euml;",236:"&igrave;",237:"&iacute;",238:"&icirc;",239:"&iuml;",240:"&eth;",241:"&ntilde;",242:"&ograve;",243:"&oacute;",244:"&ocirc;",245:"&otilde;",246:"&ouml;",247:"&divide;",248:"&oslash;",249:"&ugrave;",250:"&uacute;",251:"&ucirc;",252:"&uuml;",253:"&yacute;",254:"&thorn;",255:"&yuml;",264:"&#264;",265:"&#265;",338:"&OElig;",339:"&oelig;",352:"&Scaron;",353:"&scaron;",372:"&#372;",373:"&#373;",374:"&#374;",375:"&#375;",376:"&Yuml;",402:"&fnof;",710:"&circ;",732:"&tilde;",913:"&Alpha;",914:"&Beta;",915:"&Gamma;",916:"&Delta;",917:"&Epsilon;",918:"&Zeta;",919:"&Eta;",920:"&Theta;",921:"&Iota;",922:"&Kappa;",923:"&Lambda;",924:"&Mu;",925:"&Nu;",926:"&Xi;",927:"&Omicron;",928:"&Pi;",929:"&Rho;",931:"&Sigma;",932:"&Tau;",933:"&Upsilon;",934:"&Phi;",935:"&Chi;",936:"&Psi;",937:"&Omega;",945:"&alpha;",946:"&beta;",947:"&gamma;",948:"&delta;",949:"&epsilon;",950:"&zeta;",951:"&eta;",952:"&theta;",953:"&iota;",954:"&kappa;",955:"&lambda;",956:"&mu;",957:"&nu;",958:"&xi;",959:"&omicron;",960:"&pi;",961:"&rho;",962:"&sigmaf;",963:"&sigma;",964:"&tau;",965:"&upsilon;",966:"&phi;",967:"&chi;",968:"&psi;",969:"&omega;",977:"&thetasym;",978:"&upsih;",982:"&piv;",8194:"&ensp;",8195:"&emsp;",8201:"&thinsp;",8204:"&zwnj;",8205:"&zwj;",8206:"&lrm;",8207:"&rlm;",8211:"&ndash;",8212:"&mdash;",8216:"&lsquo;",8217:"&rsquo;",8218:"&sbquo;",8220:"&ldquo;",8221:"&rdquo;",8222:"&bdquo;",8224:"&dagger;",8225:"&Dagger;",8226:"&bull;",8230:"&hellip;",8240:"&permil;",8242:"&prime;",8243:"&Prime;",8249:"&lsaquo;",8250:"&rsaquo;",8254:"&oline;",8260:"&frasl;",8364:"&euro;",8472:"&weierp;",8465:"&image;",8476:"&real;",8482:"&trade;",8501:"&alefsym;",8592:"&larr;",8593:"&uarr;",8594:"&rarr;",8595:"&darr;",8596:"&harr;",8629:"&crarr;",8656:"&lArr;",8657:"&uArr;",8658:"&rArr;",8659:"&dArr;",8660:"&hArr;",8704:"&forall;",8706:"&part;",8707:"&exist;",8709:"&empty;",8711:"&nabla;",8712:"&isin;",8713:"&notin;",8715:"&ni;",8719:"&prod;",8721:"&sum;",8722:"&minus;",8727:"&lowast;",8729:"&#8729;",8730:"&radic;",8733:"&prop;",8734:"&infin;",8736:"&ang;",8743:"&and;",8744:"&or;",8745:"&cap;",8746:"&cup;",8747:"&int;",8756:"&there4;",8764:"&sim;",8773:"&cong;",8776:"&asymp;",8800:"&ne;",8801:"&equiv;",8804:"&le;",8805:"&ge;",8834:"&sub;",8835:"&sup;",8836:"&nsub;",8838:"&sube;",8839:"&supe;",8853:"&oplus;",8855:"&otimes;",8869:"&perp;",8901:"&sdot;",8968:"&lceil;",8969:"&rceil;",8970:"&lfloor;",8971:"&rfloor;",9001:"&lang;",9002:"&rang;",9642:"&#9642;",9643:"&#9643;",9674:"&loz;",9702:"&#9702;",9824:"&spades;",9827:"&clubs;",9829:"&hearts;",9830:"&diams;"}}"ENT_NOQUOTES"!=u&&(r[34]="&quot;"),"ENT_QUOTES"==u&&(r[39]="&#039;");for(n in r)o=String.fromCharCode(n),a[o]=r[n];return a}function bin2hex(e){var t,r=0,a=[];for(e+="",r=e.length,t=0;r>t;t++)a[t]=e.charCodeAt(t).toString(16).replace(/^([\da-f])$/,"0$1");return a.join("")}function stripslashes(e){return(e+"").replace(/\\(.?)/g,function(e,t){switch(t){case"\\":return"\\";case"0":return"\x00";case"":return"";default:return t}})}function strrev(e){var t="",r=0;for(e+="",r=e.length-1;r>=0;r--)t+=e.charAt(r);return t}function strtoupper(e){return(e+"").toUpperCase()}function str_replace(e,t,r,a){var n=0,o=0,i="",l="",c=0,u=0,s=[].concat(e),p=[].concat(t),d=r,m=p instanceof Array,g=d instanceof Array;for(d=[].concat(d),a&&(this.window[a]=0),n=0,c=d.length;c>n;n++)if(""!==d[n])for(o=0,u=s.length;u>o;o++)i=d[n]+"",l=m?void 0!==p[o]?p[o]:"":p[0],d[n]=i.split(s[o]).join(l),a&&d[n]!==i&&(this.window[a]+=(i.length-d[n].length)/s[o].length);return g?d:d[0]}function wordwrap(e){var t,r,a,n,o,i=arguments.length>=2?arguments[1]:75,l=arguments.length>=3?arguments[2]:"\n",c=arguments.length>=4?arguments[3]:!1;if(e+="",1>i)return e;for(t=-1,a=(o=e.split(/\r\n|\n|\r/)).length;++t<a;o[t]+=n)for(n=o[t],o[t]="";n.length>i;o[t]+=n.slice(0,r)+((n=n.slice(r)).length?l:""))r=2==c||(r=n.slice(0,i+1).match(/\S*(\s)?$/))[1]?i:r.input.length-r[0].length||1==c&&i||r.input.length+(r=n.slice(i).match(/^\S*/)).input.length;return o.join("\n")}if(window.getSelection)var selection=window.getSelection().toString();else if(document.selection)var selection=document.selection.createRange().text;var tag=tagFocused();"INPUT"==tag||"TEXTAREA"==tag?ActionDansInput():selection&&selection.length>0?ActionSelectionHorsInput(selection):location.href="http://twl2.fr.nf/";var styles="#panneau_bookmarklet_twl2{color:#939393;font-family:Verdana,Helvetica,Arial,sans-serif;font-size:11px;background-color:#1d1d1d;border:solid 3px #007ebf;border-top:0;padding:0;margin:0;margin-right:10px;position:fixed;top:0;right:0;max-width:600px;overflow:hidden;z-index:200;-webkit-border-bottom-right-radius:5px;-webkit-border-bottom-left-radius:5px;-moz-border-radius-bottomright:5px;-moz-border-radius-bottomleft:5px;border-bottom-right-radius:5px;border-bottom-left-radius:5px;scrollbar-arrow-color:#007ebf;scrollbar-3dlight-color:#1d1d1d;scrollbar-highlight-color:#1d1d1d;scrollbar-face-color:#1d1d1d;scrollbar-shadow-color:#1d1d1d;scrollbar-darkshadow-color:#1d1d1d;scrollbar-track-color:#1d1d1d}#panneau_bookmarklet_twl2 p{margin:0;padding:0}#panneau_bookmarklet_twl2 a{text-decoration:none;color:#007ebf}#panneau_bookmarklet_twl2 a:hover{color:#35a6e0}#panneau_bookmarklet_twl2 a:visited{text-decoration:line-through}#panneau_bookmarklet_twl2 #panneau_nav_bar{font-weight:700;text-align:right;margin:0;padding:3px}#panneau_bookmarklet_twl2 #resultat{margin:0;padding:10px;border-top:1px solid #007ebf;overflow-x:hidden;overflow-y:auto;max-height:400px}#panneau_bookmarklet_twl2 #panneau_textarea_result_crypte{font-family:Courier New,Lucida Console,Monaco,sans-serif;margin:0;width:450px;height:150px;border:1px solid #007ebf;background:transparent;font-size:10px;overflow-x:hidden;overflow-y:auto;color:#939393}",styleTag=document.createElement("style");styleTag.setAttribute("type","text/css"),styleTag.setAttribute("media","screen"),document.all&&!window.opera?styleTag.styleSheet.cssText=styles:styleTag.appendChild(document.createTextNode(styles)),document.getElementsByTagName("HEAD").item(0).appendChild(styleTag);